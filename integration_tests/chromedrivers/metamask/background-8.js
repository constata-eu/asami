LavaPack.loadBundle([[99,{"../../../../shared/constants/metametrics":5654,"../../../../shared/lib/bridge-status/metrics":5681,"../../../../shared/lib/transactions-controller-utils":5698,"../../../../shared/modules/bridge-utils/bridge.util":5702,"../../../../shared/modules/bridge-utils/caip-formatters":5703,"../../../../shared/modules/conversion.utils":5710,"../../../../shared/types/bridge-status":5734,"./metrics-utils":98},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.handleTransactionFailedTypeBridge=r.handleBridgeTransactionFailed=r.handleBridgeTransactionComplete=void 0;var s=e("../../../../shared/modules/conversion.utils"),n=e("../../../../shared/lib/transactions-controller-utils"),a=e("../../../../shared/constants/metametrics"),o=e("../../../../shared/types/bridge-status"),i=e("../../../../shared/modules/bridge-utils/bridge.util"),l=e("../../../../shared/lib/bridge-status/metrics"),c=e("../../../../shared/modules/bridge-utils/caip-formatters"),d=e("./metrics-utils");r.handleBridgeTransactionComplete=async(e,{backgroundState:t,trackEvent:r})=>{var u;const{bridgeHistoryItem:f}=e,{hasApprovalTx:m,quote:p}=f,E={metamask:t},g=(0,l.getCommonProperties)(f,E),{chain_id_destination:T,usd_actual_gas:h,usd_quoted_return:C,usd_quoted_gas:b}=g,_=(null===(u=f.status.destChain)||void 0===u?void 0:u.amount)??"0",M=(0,n.calcTokenAmount)(_,f.quote.destAsset.decimals).toNumber(),S=await(0,d.getTokenUsdValue)({chainId:(0,c.formatChainIdToHex)(T),tokenAmount:M,tokenAddress:p.destAsset.address,state:E})??0,v=C&&S?C/S:0,N=b&&h?b/h:0,y=o.StatusTypes.COMPLETE,O=o.StatusTypes.COMPLETE,A=(0,i.isEthUsdt)((0,s.decimalToPrefixedHex)(p.srcChainId),p.srcAsset.address)&&m?{allowance_reset_transaction:o.StatusTypes.COMPLETE}:undefined,w=m?{approval_transaction:o.StatusTypes.COMPLETE}:undefined,I={...g,usd_actual_return:S,quote_vs_execution_ratio:v,quoted_vs_used_gas_ratio:N,...A,...w,source_transaction:y,destination_transaction:O};r({category:a.MetaMetricsEventCategory.CrossChainSwaps,event:a.MetaMetricsEventName.ActionCompleted,properties:I})};r.handleBridgeTransactionFailed=async(e,{backgroundState:t,trackEvent:r})=>{var n;const{bridgeHistoryItem:c}=e,{hasApprovalTx:d,quote:u,status:f}=c,m={metamask:t},p=(0,l.getCommonProperties)(c,m),E=f.srcChain.txHash?o.StatusTypes.COMPLETE:o.StatusTypes.FAILED,g=null!==(n=f.destChain)&&void 0!==n&&n.txHash?o.StatusTypes.COMPLETE:o.StatusTypes.FAILED,T={...p,allowance_reset_transaction:(0,i.isEthUsdt)((0,s.decimalToPrefixedHex)(u.srcChainId),u.srcAsset.address)&&d&&f.srcChain.txHash?o.StatusTypes.COMPLETE:o.StatusTypes.FAILED,approval_transaction:d&&f.srcChain.txHash?o.StatusTypes.COMPLETE:o.StatusTypes.FAILED,source_transaction:E,destination_transaction:g,error_message:""};r({category:a.MetaMetricsEventCategory.CrossChainSwaps,event:a.MetaMetricsEventName.ActionFailed,properties:T})};r.handleTransactionFailedTypeBridge=async(e,{backgroundState:t,trackEvent:r})=>{const n={metamask:t},{transactionMeta:c}=e,d=n.metamask.bridgeStatusState.txHistory[c.id],{quote:u,hasApprovalTx:f}=d,m=(0,l.getCommonProperties)(d,n),p=o.StatusTypes.FAILED,E={...m,...(0,i.isEthUsdt)((0,s.decimalToPrefixedHex)(u.srcChainId),u.srcAsset.address)&&f?{allowance_reset_transaction:o.StatusTypes.COMPLETE}:undefined,...f?{approval_transaction:o.StatusTypes.COMPLETE}:undefined,source_transaction:p,error_message:e.error};r({category:a.MetaMetricsEventCategory.CrossChainSwaps,event:a.MetaMetricsEventName.ActionFailed,properties:E})}}}},{package:"$root$",file:"app/scripts/lib/bridge-status/metrics.ts"}],[4,{"../../shared/constants/app":5643,"../../shared/constants/metametrics":5654,"../../shared/constants/offscreen-communication":5660,"../../shared/modules/browser-runtime.utils":5707,"../../shared/modules/mv3.utils":5719,"../../shared/modules/object.utils":5721,"../../shared/modules/selectors/networks":5727,"../../test/e2e/background-socket/socket-background-to-mocha":5738,"../../test/e2e/default-fixture":5740,"../../test/stub/keyring-bridge":5746,"./constants/marketing-site-whitelist":6,"./constants/sentry-state":7,"./first-time-state":80,"./fixtures/generate-wallet-state":81,"./lib/createStreamSink":110,"./lib/ens-ipfs/setup":117,"./lib/get-first-preferred-lang-code":119,"./lib/getObjStructure":120,"./lib/migrator":124,"./lib/notification-manager":126,"./lib/setup-initial-state-hooks":156,"./lib/stores/extension-store":168,"./lib/stores/persistence-manager":169,"./lib/stores/read-only-network-store":170,"./lib/util":183,"./metamask-controller":184,"./migrations":353,"./offscreen":354,"./platforms/extension":355,"@metamask/notification-services-controller":2302,"@metamask/obs-store":2315,"@metamask/utils":2874,"debounce-stream":4147,events:4323,"extension-port-stream":4326,loglevel:4787,"readable-stream":5198,"webextension-polyfill":5620},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.loadStateFromPersistence=be,r.setupController=ve,r.statePersistenceEvents=void 0,e("./lib/setup-initial-state-hooks");var s=D(e("events")),n=e("readable-stream"),a=D(e("debounce-stream")),o=D(e("loglevel")),i=D(e("webextension-polyfill")),l=e("@metamask/obs-store"),c=e("@metamask/utils"),d=D(e("extension-port-stream")),u=e("@metamask/notification-services-controller"),f=e("../../shared/constants/app"),m=e("../../shared/constants/metametrics"),p=e("../../shared/modules/browser-runtime.utils"),E=e("../../shared/modules/mv3.utils"),g=e("../../shared/modules/object.utils"),T=(e("../../test/e2e/default-fixture"),e("../../test/e2e/background-socket/socket-background-to-mocha"),e("../../shared/constants/offscreen-communication"),e("../../test/stub/keyring-bridge")),h=e("../../shared/modules/selectors/networks"),C=e("./lib/stores/persistence-manager"),b=D(e("./lib/stores/extension-store")),_=D(e("./lib/stores/read-only-network-store")),M=D(e("./migrations")),S=D(e("./lib/migrator")),v=D(e("./platforms/extension")),N=e("./constants/sentry-state"),y=D(e("./lib/createStreamSink")),O=x(e("./lib/notification-manager")),A=x(e("./metamask-controller")),w=D(e("./lib/get-first-preferred-lang-code")),I=D(e("./lib/getObjStructure")),P=D(e("./lib/ens-ipfs/setup")),k=e("./lib/util"),R=e("./offscreen"),L=(e("./fixtures/generate-wallet-state"),D(e("./first-time-state"))),F=e("./constants/marketing-site-whitelist");function U(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(U=function(e){return e?r:t})(e)}function x(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=U(t);if(r&&r.has(e))return r.get(e);var s={__proto__:null},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var o=n?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(s,a,o):s[a]=e[a]}return s.default=e,r&&r.set(e,s),s}function D(e){return e&&e.__esModule?e:{default:e}}const B="#0376C9",V="#D73847",j=9,G=!1,H=new S.default({migrations:M.default,defaultVersion:null}),Y=G?new _.default:new b.default,q=new C.PersistenceManager({localStore:Y});global.stateHooks.getMostRecentPersistedState=()=>q.mostRecentRetrievedState;const{sentry:K}=global;let $={...L.default};const z={[f.ENVIRONMENT_TYPE_POPUP]:!0,[f.ENVIRONMENT_TYPE_NOTIFICATION]:!0,[f.ENVIRONMENT_TYPE_FULLSCREEN]:!0},W=["trezor-connect"];o.default.setLevel("info",!1);const J=new v.default,Q=new O.default,X=(0,k.getPlatform)()===f.PLATFORM_FIREFOX;let Z=0,ee=!1,te=!1;const re={},se={};let ne;const ae={};G&&(global.stateHooks.metamaskGetState=q.get.bind(q));const oe=new URL("https://metamask.github.io/phishing-warning/v4.1.0/"),ie=oe.toString(),le=1e3,ce=r.statePersistenceEvents=new s.default;if(E.isManifestV3)globalThis.stateHooks.metamaskWasJustInstalled?(Oe(),delete globalThis.stateHooks.metamaskWasJustInstalled):globalThis.stateHooks.metamaskTriggerOnInstall=()=>Oe();else{const e=t=>{"install"===t.reason&&(Oe(),i.default.runtime.onInstalled.removeListener(e))};i.default.runtime.onInstalled.addListener(e)}const{promise:de,resolve:ue,reject:fe}=(0,k.deferredPromise)(),me=async()=>{const e=await i.default.tabs.query({url:"<all_urls>",windowType:"normal"}).then((e=>((0,p.checkForLastErrorAndLog)(),e))).catch((()=>{(0,p.checkForLastErrorAndLog)()}));for(const t of e)i.default.tabs.sendMessage(t.id,{name:f.EXTENSION_MESSAGES.READY}).then((()=>{(0,p.checkForLastErrorAndLog)()})).catch((()=>{(0,p.checkForLastErrorAndLog)()}))};let pe,Ee,ge;function Te(){const e=(new Date).toISOString();i.default.storage.session.set({timestamp:e})}async function he(){try{const t=E.isManifestV3?(0,R.createOffscreen)():null,r=await be(),s=r.data,n=await(0,w.default)();let a;if(E.isManifestV3){var e;if(!1!==(null===(e=s.PreferencesController)||void 0===e?void 0:e.enableMV3TimestampSave)){const e=2e3;Te(),setInterval(Te,e)}const t=await i.default.storage.session.get(["isFirstMetaMaskControllerSetup"]);a=(null==t?void 0:t.isFirstMetaMaskControllerSetup)===undefined,await i.default.storage.session.set({isFirstMetaMaskControllerSetup:a})}ve(s,n,G?{keyrings:{trezorBridge:T.FakeTrezorBridge,ledgerBridge:T.FakeLedgerBridge}}:{},a,r.meta,t),function(e){async function t(e,t){try{return await i.default.tabs.update(e,{url:t})}catch(e){return null==K?void 0:K.captureException(e)}}const r=!E.isManifestV3;i.default.webRequest.onBeforeRequest.addListener((s=>{var n,a,o;if(s.tabId===i.default.tabs.TAB_ID_NONE)return{};const{completedOnboarding:l}=e.onboardingController.state;if(!l)return{};if(!e.preferencesController.state.usePhishDetect)return{};if(s.initiator&&new URL(s.initiator).host===oe.host)return{};const{hostname:c,href:d,searchParams:u}=new URL(s.url);if(G&&u.has("IN_TEST_BYPASS_EARLY_PHISHING_DETECTION"))return{};e.phishingController.maybeUpdateState();const f=e.phishingController.isBlockedRequest(s.url);let p,E;if("main_frame"!==s.type&&"sub_frame"!==s.type||(p=e.phishingController.test(s.url)),!(null!==(n=p)&&void 0!==n&&n.result||f.result))return{};let g=c;null!==(a=p)&&void 0!==a&&a.result&&f.result?E=`${p.type} and ${f.type}`:null!==(o=p)&&void 0!==o&&o.result?E=p.type:(E=f.type,g=s.initiator),e.metaMetricsController.trackEvent({event:m.MetaMetricsEventName.PhishingPageDisplayed,category:m.MetaMetricsEventCategory.Phishing,properties:{url:g,referrer:{url:g},reason:E,requestDomain:f.result?c:undefined}});const T=new URLSearchParams({hostname:c,href:d}),h=new URL(ie);h.hash=T.toString();const C=h.toString();return r?"main_frame"===s.type?{redirectUrl:C}:(t(s.tabId,C),{cancel:!0}):(t(s.tabId,C),{})}),{urls:["http://*/*","https://*/*","ws://*/*","wss://*/*"]},r?["blocking"]:[])}(ne),E.isManifestV3||await async function(){let e;try{const t=new URL(ie);let r,s;t.hash="#extensionStartup",e=window.document.createElement("iframe"),e.setAttribute("src",t.href),e.setAttribute("sandbox","allow-scripts allow-same-origin");const n=new Promise(((e,t)=>{r=e,s=t}));e.addEventListener("load",r),window.document.body.appendChild(e),setTimeout((()=>s(new Ce)),le),await n}catch(e){e instanceof Ce?console.warn("Phishing warning page timeout; page not guaranteed to work offline."):console.error("Failed to initialize phishing warning page",e)}finally{e&&e.remove()}}(),await me(),o.default.info("MetaMask initialization complete."),ue()}catch(e){fe(e)}}i.default.runtime.onConnect.addListener((async(...e)=>{await de,pe(...e)})),i.default.runtime.onConnectExternal.addListener((async(...e)=>{var t;await de;null===(t=e[0].sender.tab)||void 0===t||t.id;Ee(...e)}));class Ce extends Error{constructor(){super("Timeout failed")}}async function be(){H.on("error",console.warn);const e=await q.get()||H.generateInitialState($);H.on("error",(t=>{const r=(0,I.default)(e);K.captureException(t,{extra:{vaultStructure:r}})}));const t=await H.migrateData(e);if(!t)throw new Error("MetaMask - migrator returned undefined");if(!(0,c.isObject)(t.meta))throw new Error(`MetaMask - migrator metadata has invalid type '${typeof t.meta}'`);if("number"!=typeof t.meta.version)throw new Error(`MetaMask - migrator metadata version has invalid type '${typeof t.meta.version}'`);if(!(0,c.isObject)(t.data))throw new Error(`MetaMask - migrator data has invalid type '${typeof t.data}'`);return q.setMetadata(t.meta),q.set(t.data),t}function _e(e){const{metaMetricsId:t}=ne.metaMetricsController.state;if(!(0,k.shouldEmitDappViewedEvent)(t))return;const r=ne.getPermittedAccounts(e).length;if(0===r)return;const s=ne.controllerMessenger.call("PreferencesController:getState"),n=Object.keys(s.identities).length;ne.metaMetricsController.trackEvent({event:m.MetaMetricsEventName.DappViewed,category:m.MetaMetricsEventCategory.InpageProvider,referrer:{url:e},properties:{is_first_visit:!1,number_of_accounts:n,number_of_accounts_connected:r}})}function Me(e){if(!e.sender||!e.sender.tab||!e.sender.url)return;const t=e.sender.tab.id,r=new URL(e.sender.url),{origin:s}=r;Object.keys(ae).includes(t)||(ae[t]=s);const n=ne.controllerMessenger.call("PermissionController:hasPermissions",s),a="New Tab"!==e.sender.tab.title;n&&a&&_e(s)}function Se(e){const t=[f.ENVIRONMENT_TYPE_POPUP,f.ENVIRONMENT_TYPE_NOTIFICATION,f.ENVIRONMENT_TYPE_FULLSCREEN];!(Object.values(re).some(Boolean)||ee||Z>0)&&t.includes(e)&&function(){const{metaMetricsId:e,participateInMetaMetrics:t}=ne.metaMetricsController.state;(null!==e||t)&&ne.metaMetricsController.trackEvent({event:m.MetaMetricsEventName.AppOpened,category:m.MetaMetricsEventCategory.App})}()}function ve(e,t,r,s,c,p){var T;ne=new A.default({infuraProjectId:"b6bf7d3508c941499b10025c0776eaf8",showUserConfirmation:Ne,initState:e,initLangCode:t,platform:J,notificationManager:Q,browser:i.default,getRequestAccountTabIds:()=>se,getOpenMetamaskTabsIds:()=>re,persistenceManager:q,overrides:r,isFirstMetaMaskControllerSetup:s,currentMigrationVersion:c.version,featureFlags:{},offscreenPromise:p}),(0,P.default)({getCurrentChainId:()=>(0,h.getCurrentChainId)({metamask:ne.networkController.state}),getIpfsGateway:ne.preferencesController.getIpfsGateway.bind(ne.preferencesController),getUseAddressBarEnsResolution:()=>ne.preferencesController.state.useAddressBarEnsResolution,provider:ne.provider}),(0,n.pipeline)((0,l.storeAsStream)(ne.store),(0,a.default)(1e3),(0,y.default)((async e=>{await q.set(e),ce.emit("state-persisted",e)})),(e=>{o.default.error("MetaMask - Persistence pipeline failed",e)})),T=ne,global.stateHooks.getSentryAppState=function(){const e=T.memStore.getState();return(0,g.maskObject)(e,N.SENTRY_BACKGROUND_STATE)};const C=()=>Z>0||Boolean(Object.keys(re).length)||ee,b=(e,t)=>{if(!1===e)ne.onClientClosed();else{if(t===f.ENVIRONMENT_TYPE_FULLSCREEN&&Boolean(Object.keys(re).length))return;ne.onEnvironmentTypeClosed(t)}};function _(e,t){return e>t?`${t}+`:String(e)}function M(){const e=S(),t=function(){try{const{isNotificationServicesEnabled:e,isFeatureAnnouncementsEnabled:t}=ne.notificationServicesController.state,r=Object.values(ne.notificationServicesController.state.metamaskNotificationsList).filter((e=>e.type===u.NotificationServicesController.Constants.TRIGGER_TYPES.SNAP&&null===e.readDate)).length,s=t?ne.notificationServicesController.state.metamaskNotificationsList.filter((e=>!e.isRead&&e.type===u.NotificationServicesController.Constants.TRIGGER_TYPES.FEATURES_ANNOUNCEMENT)).length:0,n=e?ne.notificationServicesController.state.metamaskNotificationsList.filter((e=>!e.isRead&&e.type!==u.NotificationServicesController.Constants.TRIGGER_TYPES.FEATURES_ANNOUNCEMENT&&e.type!==u.NotificationServicesController.Constants.TRIGGER_TYPES.SNAP)).length:0;return r+s+n}catch(e){return console.error("Failed to get unread notifications count:",e),0}}();let r="",s=B;e?r=_(e,j):t>0&&(r=_(t,j),s=V);try{const e={text:r},t={color:s};E.isManifestV3?(i.default.action.setBadgeText(e),i.default.action.setBadgeBackgroundColor(t)):(i.default.browserAction.setBadgeText(e),i.default.browserAction.setBadgeBackgroundColor(t))}catch(e){console.error("Error updating browser badge:",e)}}function S(){try{let e=ne.appStateController.waitingForUnlock.length+ne.approvalController.getTotalApprovalCount();return e+=ne.queuedRequestController.state.queuedRequestCount,e}catch(e){return console.error("Failed to get pending approval count:",e),0}}pe=async e=>{var t;const s=e.name;if(W.includes(e.name))return;let a=!1;const l=null!==(t=e.sender)&&void 0!==t&&t.url?new URL(e.sender.url):null;if(a=X?z[s]:(null==l?void 0:l.origin)===`chrome-extension://${i.default.runtime.id}`,a){var c;const t=(null==r||null===(c=r.getPortStream)||void 0===c?void 0:c.call(r,e))||new d.default(e);if(ne.isClientOpen=!0,ne.setupTrustedCommunication(t,e.sender),Se(s),async function(){try{await ne.remoteFeatureFlagController.updateRemoteFeatureFlags()}catch(e){o.default.error("Error initializing remote feature flags:",e)}}(),s===f.ENVIRONMENT_TYPE_POPUP&&(Z+=1,(0,n.finished)(t,(()=>{Z-=1;const e=C();ne.isClientOpen=e,b(e,f.ENVIRONMENT_TYPE_POPUP)}))),s===f.ENVIRONMENT_TYPE_NOTIFICATION&&(ee=!0,(0,n.finished)(t,(()=>{ee=!1;const e=C();ne.isClientOpen=e,b(e,f.ENVIRONMENT_TYPE_NOTIFICATION)}))),s===f.ENVIRONMENT_TYPE_FULLSCREEN){const r=e.sender.tab.id;re[r]=!0,(0,n.finished)(t,(()=>{delete re[r];const e=C();ne.isClientOpen=e,b(e,f.ENVIRONMENT_TYPE_FULLSCREEN)}))}}else if(l&&l.origin===oe.origin&&l.pathname===oe.pathname){var u;const t=(null==r||null===(u=r.getPortStream)||void 0===u?void 0:u.call(r,e))||new d.default(e);ne.setupPhishingCommunication({connectionStream:t})}else{if(e.sender&&e.sender.tab&&e.sender.url){const t=e.sender.tab.id,r=new URL(e.sender.url),{origin:s}=r;Me(e),e.onMessage.addListener((e=>{e.data&&e.data.method===f.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS&&(se[s]=t)}))}if(l&&F.COOKIE_ID_MARKETING_WHITELIST_ORIGINS.some((e=>e===l.origin))){var m;const t=(null==r||null===(m=r.getPortStream)||void 0===m?void 0:m.call(r,e))||new d.default(e);ne.setUpCookieHandlerCommunication({connectionStream:t})}Ee(e)}},Ee=e=>{var t;const s=(null==r||null===(t=r.getPortStream)||void 0===t?void 0:t.call(r,e))||new d.default(e);ne.setupUntrustedCommunicationEip1193({connectionStream:s,sender:e.sender})},ge=async e=>{},null!=r&&r.registerConnectListeners&&r.registerConnectListeners(pe,Ee),M(),ne.controllerMessenger.subscribe(A.METAMASK_CONTROLLER_EVENTS.DECRYPT_MESSAGE_MANAGER_UPDATE_BADGE,M),ne.controllerMessenger.subscribe(A.METAMASK_CONTROLLER_EVENTS.ENCRYPTION_PUBLIC_KEY_MANAGER_UPDATE_BADGE,M),ne.signatureController.hub.on(A.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,M),ne.controllerMessenger.subscribe(A.METAMASK_CONTROLLER_EVENTS.APP_STATE_UNLOCK_CHANGE,M),ne.controllerMessenger.subscribe(A.METAMASK_CONTROLLER_EVENTS.APPROVAL_STATE_CHANGE,M),ne.controllerMessenger.subscribe(A.METAMASK_CONTROLLER_EVENTS.QUEUED_REQUEST_STATE_CHANGE,M),ne.controllerMessenger.subscribe(A.METAMASK_CONTROLLER_EVENTS.METAMASK_NOTIFICATIONS_LIST_UPDATED,M),ne.controllerMessenger.subscribe(A.METAMASK_CONTROLLER_EVENTS.METAMASK_NOTIFICATIONS_MARK_AS_READ,M),Q.on(O.NOTIFICATION_MANAGER_EVENTS.POPUP_CLOSED,(({automaticallyClosed:e})=>{e?S()>0&&Ne():(ne.signatureController.rejectUnapproved(m.REJECT_NOTIFICATION_CLOSE_SIG),ne.decryptMessageController.rejectUnapproved(m.REJECT_NOTIFICATION_CLOSE),ne.encryptionPublicKeyController.rejectUnapproved(m.REJECT_NOTIFICATION_CLOSE),ne.rejectAllPendingApprovals()),M()})),Object.values(ne.snapController.state.snaps).some((e=>!e.preinstalled))&&ne.snapController.updateBlockedSnaps()}async function Ne(){const e=await J.getActiveTabs(),t=Boolean(e.find((e=>re[e.id]))),r=e.length>0&&e[0].extData&&e[0].extData.indexOf("vivaldi_tab")>-1;if(!te&&(r||0===Z)&&!t){te=!0;try{const e=ne.appStateController.getCurrentPopupId();await Q.showPopup((e=>ne.appStateController.setCurrentPopupId(e)),e)}finally{te=!1}}}const ye=()=>{if(ne)return ne.metaMetricsController.updateTraits({[m.MetaMetricsUserTrait.InstallDateExt]:(new Date).toISOString().split("T")[0]}),void ne.metaMetricsController.addEventBeforeMetricsOptIn({category:m.MetaMetricsEventCategory.App,event:m.MetaMetricsEventName.AppInstalled,properties:{}});setTimeout((()=>{ye()}),500)};function Oe(){o.default.debug("First install detected"),ye(),J.openExtensionInBrowser()}(async function(){i.default.tabs.onActivated.addListener((e=>{if(ne){const{tabId:t}=e,r=ae[t];r&&ne.permissionController.state.subjects[r]!==undefined&&_e(r)}}));try{await he(),q.cleanUpMostRecentRetrievedState()}catch(e){o.default.error(e)}})()}}},{package:"$root$",file:"app/scripts/background.js"}]],[4],{});